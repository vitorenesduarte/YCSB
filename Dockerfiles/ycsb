FROM vitorenesduarte/ycsb-ir

MAINTAINER Vitor Enes <vitorenesduarte@gmail.com>

ADD https://api.github.com/repos/vitorenesduarte/YCSB/git/refs/heads/epaxos ycsb-version.json
RUN git clone -b epaxos https://github.com/vitorenesduarte/YCSB
RUN mvn -f YCSB -pl com.yahoo.ycsb:mgbsmap-binding -am clean package -DskipTests

#RUN mvn -f YCSB -pl com.yahoo.ycsb:cassandra-binding,com.yahoo.ycsb:cassandra-binding -am clean package -DskipTests

#RUN tar zxvf /app/YCSB/epaxos/target/ycsb-epaxos-binding-0.13.0-SNAPSHOT.tar.gz -C /app
RUN tar zxvf /app/YCSB/mgbsmap/target/ycsb-mgbsmap-binding-0.13.0-SNAPSHOT.tar.gz -C /app
#RUN tar zxvf /app/YCSB/cassandra/target/ycsb-cassandra-binding-0.13.0-SNAPSHOT.tar.gz -C /app

RUN mkdir /app/ycsb-binding-0.13.0-SNAPSHOT
#RUN cp -Rf /app/ycsb-epaxos-binding-0.13.0-SNAPSHOT/* /app/ycsb-binding-0.13.0-SNAPSHOT
RUN cp -Rf /app/ycsb-mgbsmap-binding-0.13.0-SNAPSHOT/* /app/ycsb-binding-0.13.0-SNAPSHOT
#RUN cp -Rf /app/ycsb-cassandra-binding-0.13.0-SNAPSHOT/* /app/ycsb-binding-0.13.0-SNAPSHOT

ENV TYPE load
ENV DB epaxos

ENV WORKLOAD workloada
ENV THREADS 1
ENV RECORDCOUNT 1000
ENV OPERATIONCOUNT 1000

ENV HOST localhost
ENV PORT 7087
ENV LEADERLESS false
ENV FAST false
ENV EXTRA ""
ENV SMAPPORT 8980
ENV STATICSMAP false

CMD ["sh", "-c", "/app/ycsb-binding-0.13.0-SNAPSHOT/bin/ycsb ${TYPE} ${DB} \
    -P /app/ycsb-binding-0.13.0-SNAPSHOT/workloads/${WORKLOAD} \
    -threads ${THREADS} \
    -p recordcount=${RECORDCOUNT} \
    -p operationcount=${OPERATIONCOUNT} \
    -p host=${HOST} \
    -p static=${STATICSMAP} \
    -p port=${PORT} \
    -p leaderless=${LEADERLESS} \
    -p fast=${FAST} \
    -p smapport=${SMAPPORT} \
    ${EXTRA}"]
